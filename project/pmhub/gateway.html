<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/project/pmhub/gateway.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Gateway"><meta property="og:description" content="PmHub - Global filter interface & API service call time consumption B√†i vi·∫øt n√†y s·∫Ω ch·ªß y·∫øu n√≥i v·ªÅ c√°ch tri·ªÉn khai b·ªô l·ªçc to√†n c·ª•c t√πy ch·ªânh trong PmHub v√† c√°ch th·ª±c hi·ªán th·ªëng ..."><meta property="og:type" content="article"><meta property="og:image" content="https://docs.konghq.com/assets/images/products/konnect/gateway-manager/konnect-control-planes-example.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-10-02T17:20:50.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="java"><meta property="article:tag" content="microservice"><meta property="article:tag" content="gateway"><meta property="article:modified_time" content="2024-10-02T17:20:50.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Gateway","image":["https://docs.konghq.com/assets/images/products/konnect/gateway-manager/konnect-control-planes-example.png","https://docs.konghq.com/assets/images/products/gateway/kong-gateway-features.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/1716526492684-86556361-5100-4172-946b-e5f825979b3d.png"],"dateModified":"2024-10-02T17:20:50.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Gateway | VanHung4499</title><meta name="description" content="PmHub - Global filter interface & API service call time consumption B√†i vi·∫øt n√†y s·∫Ω ch·ªß y·∫øu n√≥i v·ªÅ c√°ch tri·ªÉn khai b·ªô l·ªçc to√†n c·ª•c t√πy ch·ªânh trong PmHub v√† c√°ch th·ª±c hi·ªán th·ªëng ...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-CmlOSuIY.js"><link rel="modulepreload" href="/assets/gateway.html-CqvgSmki.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container no-sidebar external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Gateway</h1><div class="page-info"><span class="page-author-info" aria-label="Authorüñä" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateüìÖ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-10-02T17:20:50.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time‚åõ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 22 min</span><meta property="timeRequired" content="PT22M"></span><span class="page-category-info" aria-label="Categoryüåà" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color6 clickable" role="navigation">project</span><!--]--><meta property="articleSection" content="project"></span><span class="page-tag-info" aria-label="Tagüè∑" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color2 clickable" role="navigation">microservice</span><span class="page-tag-item color5 clickable" role="navigation">gateway</span><!--]--><meta property="keywords" content="java,microservice,gateway"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#gateway-la-gi">Gateway l√† g√¨?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cac-loai-gateway-cho-microservices-pho-bien">C√°c lo·∫°i Gateway cho microservices ph·ªï bi·∫øn?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#so-sanh-springcloud-gateway-voi-zuul">So s√°nh SpringCloud Gateway v·ªõi Zuul</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ba-thanh-phan-cot-loi-cua-gateway">Ba th√†nh ph·∫ßn c·ªët l√µi c·ªßa Gateway</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ƒëinh-tuyen-route">ƒê·ªãnh tuy·∫øn (Route)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ƒëieu-kien-predicate">ƒêi·ªÅu ki·ªán (Predicate)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bo-loc-filter">B·ªô l·ªçc (Filter)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cau-hinh-gioi-han-luu-luong-rate-limiter">C·∫•u h√¨nh gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng (Rate limiter)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cau-hinh-blacklist">C·∫•u h√¨nh blacklist</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cau-hinh-whitelist">C·∫•u h√¨nh whitelist</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cach-viet-bo-loc-toan-cuc">C√°ch vi·∫øt b·ªô l·ªçc to√†n c·ª•c</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cach-thong-ke-thoi-gian-goi-api">C√°ch th·ªëng k√™ th·ªùi gian g·ªçi API</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="pmhub-global-filter-interface-api-service-call-time-consumption" tabindex="-1"><a class="header-anchor" href="#pmhub-global-filter-interface-api-service-call-time-consumption"><span>PmHub - Global filter interface &amp; API service call time consumption</span></a></h1><p>B√†i vi·∫øt n√†y s·∫Ω ch·ªß y·∫øu n√≥i v·ªÅ c√°ch tri·ªÉn khai b·ªô l·ªçc to√†n c·ª•c t√πy ch·ªânh trong PmHub v√† c√°ch th·ª±c hi·ªán th·ªëng k√™ th·ªùi gian x·ª≠ l√Ω c·ªßa c√°c API. Ch√∫ng ta s·∫Ω ƒëi t·ª´ l√Ω thuy·∫øt ƒë·∫øn th·ª±c h√†nh v√† cu·ªëi c√πng l√† ph·ªèng v·∫•n.</p><blockquote><ul><li>T√πy ch·ªânh b·ªô l·ªçc to√†n c·ª•c c·ªßa SpringCloud Gateway, th·ª±c hi·ªán vi·ªác x√°c th·ª±c th·ªëng nh·∫•t tr√™n c·ªïng t√πy ch·ªânh v√† th·ªëng k√™ th·ªùi gian g·ªçi API.</li></ul></blockquote><h1 id="kien-thuc-ly-thuyet" tabindex="-1"><a class="header-anchor" href="#kien-thuc-ly-thuyet"><span>Ki·∫øn th·ª©c l√Ω thuy·∫øt</span></a></h1><h2 id="gateway-la-gi" tabindex="-1"><a class="header-anchor" href="#gateway-la-gi"><span>Gateway l√† g√¨?</span></a></h2><p>Ki·∫øn tr√∫c microservices ƒë√£ tr·ªü th√†nh xu h∆∞·ªõng ch√≠nh trong ph√°t tri·ªÉn ·ª©ng d·ª•ng hi·ªán ƒë·∫°i, v√† ƒë·ªëi v·ªõi ch√∫ng ta, ƒë√¢y c≈©ng l√† m·ªôt <strong>y·∫øu t·ªë c·ª±c k·ª≥ quan tr·ªçng</strong> trong ph·ªèng v·∫•n.</p><p>Ki·∫øn tr√∫c microservices ph√¢n chia ·ª©ng d·ª•ng monolith tr∆∞·ªõc ƒë√¢y th√†nh c√°c d·ªãch v·ª• nh·ªè h∆°n, m·ªói d·ªãch v·ª• c√≥ th·ªÉ ƒë∆∞·ª£c tri·ªÉn khai, m·ªü r·ªông v√† b·∫£o tr√¨ ƒë·ªôc l·∫≠p. Tuy nhi√™n, ki·∫øn tr√∫c microservices c≈©ng mang l·∫°i m·ªôt s·ªë th√°ch th·ª©c, m·ªôt trong s·ªë ƒë√≥ l√† qu·∫£n l√Ω giao ti·∫øp gi·ªØa c√°c d·ªãch v·ª•. L√∫c n√†y, Gateway cho microservices tr·ªü th√†nh m·ªôt th√†nh ph·∫ßn kh√¥ng th·ªÉ thi·∫øu.</p><p>Gateway cho microservices l√† m·ªôt th√†nh ph·∫ßn n·∫±m ·ªü ph√≠a tr∆∞·ªõc ki·∫øn tr√∫c microservices, n√≥ ƒë√≥ng vai tr√≤ l√† <strong>c·ªïng v√†o c·ªßa t·∫•t c·∫£ c√°c d·ªãch v·ª•</strong>. Gateway ch·ªãu tr√°ch nhi·ªám ƒëi·ªÅu h∆∞·ªõng request, c√¢n b·∫±ng t·∫£i, x√°c th·ª±c b·∫£o m·∫≠t, ki·ªÉm so√°t l∆∞u l∆∞·ª£ng, gi√°m s√°t v√† ghi nh·∫≠t k√Ω. N√≥ gi√∫p t·∫≠p h·ª£p c√°c d·ªãch v·ª• th√†nh m·ªôt API duy nh·∫•t, t·ª´ ƒë√≥ ƒë∆°n gi·∫£n h√≥a vi·ªác giao ti·∫øp gi·ªØa client v√† c√°c d·ªãch v·ª•.</p><p>API Gateway c√≥ th·ªÉ hi·ªÉu nh∆∞ l√† <strong>ng∆∞·ªùi b·∫£o v·ªá</strong> c·ªßa h·ªá th·ªëng microservices, l√† m·ªôt th√†nh ph·∫ßn quan tr·ªçng trong ki·∫øn tr√∫c microservices, qu·∫£n l√Ω v√† ƒëi·ªÅu ph·ªëi l∆∞u l∆∞·ª£ng t·ª´ c√°c request b√™n ngo√†i v√†o c√°c d·ªãch v·ª• b√™n trong. ƒê·ªÉ d·ªÖ hi·ªÉu h∆°n, h√£y so s√°nh v·ªõi m·ªôt v√≠ d·ª• trong ƒë·ªùi s·ªëng:</p><p>M·ªôt trung t√¢m mua s·∫Øm l·ªõn (h·ªá th·ªëng microservices) c√≥ nhi·ªÅu c·ª≠a h√†ng kh√°c nhau (c√°c d·ªãch v·ª• kh√°c nhau), v√≠ d·ª• nh∆∞ c·ª≠a h√†ng qu·∫ßn √°o, nh√† h√†ng, r·∫°p chi·∫øu phim, v.v. M·ªói c·ª≠a h√†ng c√≥ <strong>c·ªïng v√†o ri√™ng bi·ªát</strong>. ƒêi·ªÅu n√†y gi√∫p m·ªói c·ª≠a h√†ng c√≥ th·ªÉ ho·∫°t ƒë·ªông ƒë·ªôc l·∫≠p. Tuy nhi√™n, n·∫øu kh√¥ng c√≥ <strong>c·ªïng v√†o chung</strong> cho kh√°ch h√†ng, vi·ªác qu·∫£n l√Ω s·∫Ω tr·ªü n√™n h·ªón lo·∫°n.</p><p>Ngo√†i ra, trung t√¢m mua s·∫Øm c·∫ßn qu·∫£n l√Ω l∆∞·ª£ng kh√°ch v√†o t·ª´ng c·ª≠a h√†ng, ch·∫≥ng h·∫°n nh∆∞ ngƒÉn ch·∫∑n t√¨nh tr·∫°ng qu√° t·∫£i t·∫°i m·ªôt c·ª≠a h√†ng ho·∫∑c x·ª≠ l√Ω ∆∞u ƒë√£i cho th√†nh vi√™n.</p><p>Gateway c√≥ th·ªÉ l√†m ƒë∆∞·ª£c g√¨?</p><ul><li><strong>Reverse Proxy</strong>: Receives client requests and forwards them to the backend service</li><li><strong>Authentication</strong>: Authentication and permission checks for client requests</li><li><strong>Flow Control</strong>: Manage and limit request traffic entering the system</li><li><strong>Circuit breaker</strong>: Temporarily stop request forwarding to this service</li><li><strong>Authorization</strong> : Verify and check the identity and permissions of client requests</li></ul><h2 id="cac-loai-gateway-cho-microservices-pho-bien" tabindex="-1"><a class="header-anchor" href="#cac-loai-gateway-cho-microservices-pho-bien"><span>C√°c lo·∫°i Gateway cho microservices ph·ªï bi·∫øn?</span></a></h2><p>Nh·ªØng gi·∫£i ph√°p gateway cho microservices ph·ªï bi·∫øn bao g·ªìm <a href="https://github.com/Netflix/zuul" target="_blank" rel="noopener noreferrer">Zuul</a> c·ªßa Spring Cloud Netflix, <a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway</a>, v√† c√°c gateway kh√°c nh∆∞ <a href="https://docs.konghq.com/gateway" target="_blank" rel="noopener noreferrer">Kong</a>.</p><p>Kong Gateway l√† m·ªôt gateway API m√£ ngu·ªìn m·ªü nh·∫π, ph√°t tri·ªÉn d·ª±a tr√™n OpenResty + Lua, cung c·∫•p nhi·ªÅu t√≠nh nƒÉng phong ph√∫ v√† kh·∫£ nƒÉng m·ªü r·ªông linh ho·∫°t, c√≥ th·ªÉ m·ªü r·ªông ch·ª©c nƒÉng c·ªßa Kong th√¥ng qua c√°c plugin.</p><figure><img src="https://docs.konghq.com/assets/images/products/konnect/gateway-manager/konnect-control-planes-example.png" alt="Gi·ªõi thi·ªáu t·ª´ trang ch√≠nh th·ª©c" tabindex="0" loading="lazy"><figcaption>Gi·ªõi thi·ªáu t·ª´ trang ch√≠nh th·ª©c</figcaption></figure><p>∆Øu ƒëi·ªÉm c·ªßa Kong Gateway:</p><ul><li><strong>Hi·ªáu su·∫•t cao</strong>: Kong d·ª±a tr√™n Nginx v√† OpenResty, c√≥ hi·ªáu su·∫•t v√† kh·∫£ nƒÉng m·ªü r·ªông r·∫•t cao, ph√π h·ª£p v·ªõi c√°c t√¨nh hu·ªëng x·ª≠ l√Ω nhi·ªÅu request ƒë·ªìng th·ªùi.</li><li><strong>H·ªá sinh th√°i plugin</strong>: Kong cung c·∫•p nhi·ªÅu plugin, d·ªÖ d√†ng th·ª±c hi·ªán x√°c th·ª±c, gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng, ghi nh·∫≠t k√Ω, gi√°m s√°t, v√† c√≥ th·ªÉ t·ª± t·∫°o plugin b·∫±ng Lua.</li><li><strong>H·ªó tr·ª£ ƒëa ng√¥n ng·ªØ</strong>: Kong h·ªó tr·ª£ nhi·ªÅu ng√¥n ng·ªØ l·∫≠p tr√¨nh th√¥ng qua h·ªá th·ªëng plugin, nh∆∞ Lua, Go, Python, v.v.</li><li><strong>H·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng</strong>: Kong c√≥ th·ªÉ ch·∫°y tr√™n nhi·ªÅu n·ªÅn t·∫£ng nh∆∞ Kubernetes, Docker, v.v., ph√π h·ª£p v·ªõi nhi·ªÅu m√¥i tr∆∞·ªùng tri·ªÉn khai.</li><li><strong>H·ªó tr·ª£ doanh nghi·ªáp</strong>: Kong cung c·∫•p phi√™n b·∫£n doanh nghi·ªáp v·ªõi nhi·ªÅu t√≠nh nƒÉng cao c·∫•p v√† h·ªó tr·ª£ th∆∞∆°ng m·∫°i, ph√π h·ª£p v·ªõi c√°c k·ªãch b·∫£n request h·ªó tr·ª£ c·∫•p doanh nghi·ªáp.</li></ul><figure><img src="https://docs.konghq.com/assets/images/products/gateway/kong-gateway-features.png" alt="T·ª´ trang ch√≠nh th·ª©c c·ªßa Kong" tabindex="0" loading="lazy"><figcaption>T·ª´ trang ch√≠nh th·ª©c c·ªßa Kong</figcaption></figure><p>Tuy nhi√™n, do Kong c√≥ chi ph√≠ h·ªçc t·∫≠p cao v√† vi·ªác t·∫°o plugin t√πy ch·ªânh ph·∫£i s·ª≠ d·ª•ng Lua, kh√¥ng th√¢n thi·ªán v·ªõi Java, n√™n Kong kh√¥ng ph·ªï bi·∫øn trong h·ªá sinh th√°i Java.</p><p>Ti·∫øp theo, trong h·ªá sinh th√°i Java, ch·ªâ c√≤n l·∫°i hai gi·∫£i ph√°p ch·ªß ƒë·∫°o l√† SpringCloud Gateway v√† Zuul. Nh∆∞ng do phi√™n b·∫£n 2.x c·ªßa Zuul li√™n t·ª•c tr√¨ ho√£n vi·ªác c·∫≠p nh·∫≠t, SpringCloud cu·ªëi c√πng ƒë√£ ph√°t tri·ªÉn m·ªôt gateway m·ªõi l√† SpringCloud Gateway ƒë·ªÉ thay th·∫ø Zuul, <strong>v√¨ v·∫≠y SpringCloud Gateway l√† s·ª± thay th·∫ø cho phi√™n b·∫£n Zuul 1.x</strong>.</p><p>Trong c√°c d·ª± √°n m·ªõi, h√£y s·ª≠ d·ª•ng SpringCloud Gateway.</p><p>Ti·∫øp theo, ch√∫ng ta s·∫Ω ƒëi s√¢u v√†o hai gateway ch√≠nh l√† SpringCloud Gateway v√† Zuul.</p><h2 id="so-sanh-springcloud-gateway-voi-zuul" tabindex="-1"><a class="header-anchor" href="#so-sanh-springcloud-gateway-voi-zuul"><span>So s√°nh SpringCloud Gateway v·ªõi Zuul</span></a></h2><table><thead><tr><th>ƒêi·ªÉm so s√°nh</th><th>Spring Cloud Gateway</th><th>Zuul</th></tr></thead><tbody><tr><td>Ki·∫øn tr√∫c v√† thi·∫øt k·∫ø</td><td>D·ª±a tr√™n Spring 5, Spring Boot 2 v√† Project Reactor, m√¥ h√¨nh l·∫≠p tr√¨nh ph·∫£n ·ª©ng</td><td>D·ª±a tr√™n Servlet, m√¥ h√¨nh ch·∫∑n</td></tr><tr><td>Hi·ªáu su·∫•t</td><td>ƒê·ªô tr·ªÖ th·∫•p, th√¥ng l∆∞·ª£ng cao, ph√π h·ª£p v·ªõi c√°c k·ªãch b·∫£n c√≥ nhi·ªÅu request ƒë·ªìng th·ªùi</td><td>Hi·ªáu su·∫•t k√©m, c√≥ th·ªÉ g·∫∑p n√∫t th·∫Øt c·ªï chai trong c√°c t√¨nh hu·ªëng ƒë·ªìng th·ªùi cao</td></tr><tr><td>T√≠nh nƒÉng</td><td>ƒê·ªãnh tuy·∫øn ƒë·ªông, h·ªó tr·ª£ WebSocket, nhi·ªÅu nh√† m√°y b·ªô l·ªçc, t√≠ch h·ª£p v·ªõi Spring Security, gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng, th·ª≠ l·∫°i, ng·∫Øt m·∫°ch</td><td>Ch·ª©c nƒÉng ƒë·ªãnh tuy·∫øn v√† l·ªçc c∆° b·∫£n, h·ªó tr·ª£ b·ªô l·ªçc tr∆∞·ªõc v√† sau</td></tr><tr><td>D·ªÖ s·ª≠ d·ª•ng</td><td>T√≠ch h·ª£p m∆∞·ª£t m√† v·ªõi h·ªá sinh th√°i Spring, tr·∫£i nghi·ªám ph√°t tri·ªÉn nh·∫•t qu√°n, t√†i li·ªáu v√† c·ªông ƒë·ªìng h·ªó tr·ª£ t·ªët</td><td>C·∫•u h√¨nh v√† m·ªü r·ªông ƒë∆°n gi·∫£n, nh∆∞ng t√≠nh nƒÉng h·∫°n ch·∫ø</td></tr><tr><td>B·∫£o tr√¨ v√† h·ªó tr·ª£ c·ªông ƒë·ªìng</td><td>ƒê∆∞·ª£c duy tr√¨ t√≠ch c·ª±c b·ªüi VMware, c·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n, c·ªông ƒë·ªìng s√¥i ƒë·ªông, t√†i li·ªáu phong ph√∫</td><td>Zuul 1 ƒë√£ b·ªã l∆∞u tr·ªØ, Zuul 2 c√≥ √≠t s·ª± h·ªó tr·ª£ t·ª´ c·ªông ƒë·ªìng</td></tr><tr><td>Plugin v√† kh·∫£ nƒÉng m·ªü r·ªông</td><td>Cung c·∫•p nhi·ªÅu t√≠nh nƒÉng v√† plugin t√≠ch h·ª£p, kh·∫£ nƒÉng m·ªü r·ªông t·ªët</td><td>H·ªá sinh th√°i plugin y·∫øu h∆°n, kh·∫£ nƒÉng m·ªü r·ªông ch·ª©c nƒÉng h·∫°n ch·∫ø</td></tr><tr><td>Chi ph√≠ h·ªçc t·∫≠p</td><td>C·∫ßn h·ªçc m√¥ h√¨nh l·∫≠p tr√¨nh ph·∫£n ·ª©ng (th·ª≠ th√°ch cho nh·ªØng ng∆∞·ªùi ch∆∞a quen)</td><td>T∆∞∆°ng ƒë·ªëi ƒë∆°n gi·∫£n, ph√π h·ª£p v·ªõi c√°c d·ª± √°n nh·ªè v√† v·ª´a</td></tr><tr><td>T√¨nh hu·ªëng s·ª≠ d·ª•ng ƒëi·ªÉn h√¨nh</td><td>·ª®ng d·ª•ng doanh nghi·ªáp request hi·ªáu su·∫•t cao, ƒë·ªìng th·ªùi l·ªõn v√† nhi·ªÅu t√≠nh nƒÉng m·ªü r·ªông</td><td>C√°c d·ª± √°n nh·ªè v√† v·ª´a kh√¥ng c·∫ßn x·ª≠ l√Ω c√°c t√¨nh hu·ªëng ƒë·ªìng th·ªùi cao</td></tr></tbody></table><p>M·∫∑c d√π Zuul 1.x ƒë√£ b·ªã Gateway thay th·∫ø, nh∆∞ng ch√∫ng ta v·∫´n c·∫ßn bi·∫øt xu h∆∞·ªõng ph√°t tri·ªÉn c√¥ng ngh·ªá v√† c√≥ m·ªôt c√°i nh√¨n t·ªïng quan. N·∫øu ai ƒë√≥ v·∫´n ƒëang s·ª≠ d·ª•ng Zuul trong c√°c d·ª± √°n m·ªõi th√¨ kh·∫£ nƒÉng l√† h·ªç ƒëang g·∫∑p v·∫•n ƒë·ªÅ.</p><p>V√¨ v·∫≠y, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Gateway ph·ªï bi·∫øn nh·∫•t hi·ªán nay. T∆∞∆°ng lai kh√¥ng th·ªÉ ƒëo√°n tr∆∞·ªõc, nh∆∞ng vi·ªác theo s√°t s·∫Ω gi√∫p b·∫°n c√≥ ƒë∆∞·ª£c offer v√† kh√¥ng b·ªã l·∫°c l·ªëi trong c√¥ng ngh·ªá.</p><h2 id="ba-thanh-phan-cot-loi-cua-gateway" tabindex="-1"><a class="header-anchor" href="#ba-thanh-phan-cot-loi-cua-gateway"><span>Ba th√†nh ph·∫ßn c·ªët l√µi c·ªßa Gateway</span></a></h2><p>Theo gi·ªõi thi·ªáu t·ª´ trang ch·ªß, ba th√†nh ph·∫ßn c·ªët l√µi c·ªßa Spring Cloud Gateway l·∫ßn l∆∞·ª£t l√† <strong>Route</strong> (ƒê·ªãnh tuy·∫øn), <strong>Predicate</strong> (M·ªánh ƒë·ªÅ) v√† <strong>Filter</strong> (B·ªô l·ªçc), ch√∫ng t·∫°o n√™n c√°c ch·ª©c nƒÉng thi·∫øt y·∫øu c·ªßa Gateway.</p><blockquote><p>Glossary</p><ul><li><strong>Route</strong>: The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.</li><li><strong>Predicate</strong>: This is a¬†<a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html" target="_blank" rel="noopener noreferrer">Java 8 Function Predicate</a>. The input type is a¬†<a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html" target="_blank" rel="noopener noreferrer">Spring Framework¬†<code>ServerWebExchange</code></a>. This lets you match on anything from the HTTP request, such as headers or parameters.</li><li><strong>Filter</strong>: These are instances of¬†<a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/GatewayFilter.java" target="_blank" rel="noopener noreferrer"><code>GatewayFilter</code></a>¬†that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.</li></ul></blockquote><p>Frontend web s·∫Ω g·ª≠i request, th√¥ng qua m·ªôt s·ªë ƒëi·ªÅu ki·ªán kh·ªõp, ƒë·ªÉ x√°c ƒë·ªãnh node d·ªãch v·ª• th·ª±c s·ª±. Trong qu√° tr√¨nh chuy·ªÉn ti·∫øp request n√†y, ch√∫ng ta c√≥ th·ªÉ th·ª±c hi·ªán m·ªôt s·ªë ki·ªÉm so√°t tinh ch·ªânh.</p><p>Predicate ch√≠nh l√† ƒëi·ªÅu ki·ªán kh·ªõp c·ªßa ch√∫ng ta.</p><p>Filter c√≥ th·ªÉ ƒë∆∞·ª£c hi·ªÉu nh∆∞ m·ªôt b·ªô ch·∫∑n m·ªçi ch·ª©c nƒÉng. Khi c√≥ hai y·∫øu t·ªë n√†y, c·ªông v·ªõi URI m·ª•c ti√™u, ch√∫ng ta c√≥ th·ªÉ th·ª±c hi·ªán m·ªôt ƒë·ªãnh tuy·∫øn c·ª• th·ªÉ.</p><h3 id="ƒëinh-tuyen-route" tabindex="-1"><a class="header-anchor" href="#ƒëinh-tuyen-route"><span>ƒê·ªãnh tuy·∫øn (Route)</span></a></h3><p>Route l√† module c∆° b·∫£n ƒë·ªÉ x√¢y d·ª±ng API Gateway. N√≥ bao g·ªìm ID, URI m·ª•c ti√™u, m·ªôt lo·∫°t c√°c ƒëi·ªÅu ki·ªán (predicates) v√† c√°c b·ªô l·ªçc (filters). N·∫øu c√°c ƒëi·ªÅu ki·ªán n√†y tr·∫£ v·ªÅ gi√° tr·ªã <strong>true</strong>, th√¨ request s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ·ª©ng.</p><p>Trong PmHub, c·∫•u h√¨nh ƒë·ªãnh tuy·∫øn c·ªßa gateway nh∆∞ sau:</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        locator</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          lowerCaseServiceId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          enabled</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # Configuration center</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-auth</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">lb://pmhub-auth</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/auth/**</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            # Handle authentication code</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">CacheRequestFilter</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            # - ValidateCodeFilter</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">StripPrefix=1</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # Code gen</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gen</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">lb://pmhub-gen</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/gen/**</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">StripPrefix=0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>V√≠ d·ª•, ƒë·ªëi v·ªõi authentication service center, <code>id</code> ƒë∆∞·ª£c ƒë·∫∑t l√† <code>auth</code>, tr√πng v·ªõi t√™n d·ªãch v·ª• ƒë√£ ƒëƒÉng k√Ω trong Nacos. Nh∆∞ v·∫≠y, t·∫•t c·∫£ c√°c request ch·ª©a &quot;/auth/**&quot; trong URL s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ti·∫øp ƒë·∫øn authentication service center.</p><p>Trong Spring Cloud Gateway, c√≥ ba c√°ch ƒë·ªÉ c·∫•u h√¨nh URI:</p><ul><li><strong>C·∫•u h√¨nh theo websocket</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-api</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">ws://localhost:9090/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/api/**</span></span></code></pre></div><ul><li><strong>C·∫•u h√¨nh theo ƒë·ªãa ch·ªâ http</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-api</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9090/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/api/**</span></span></code></pre></div><ul><li><strong>C·∫•u h√¨nh theo service configuration center</strong></li></ul><p>Trong PmHub, ph∆∞∆°ng ph√°p n√†y s·ª≠ d·ª•ng c·∫•u h√¨nh qua Nacos.</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-api</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">lb://ruoyi-api</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/api/**</span></span></code></pre></div><h3 id="ƒëieu-kien-predicate" tabindex="-1"><a class="header-anchor" href="#ƒëieu-kien-predicate"><span>ƒêi·ªÅu ki·ªán (Predicate)</span></a></h3><p>Predicate c√≥ th·ªÉ hi·ªÉu l√† <strong>quy t·∫Øc kh·ªõp</strong>. V√≠ d·ª•, c·∫•u h√¨nh trong PmHub v·ªõi <code>- Path=/auth/**</code> nghƒ©a l√† t·∫•t c·∫£ c√°c request c√≥ ƒë∆∞·ªùng d·∫´n ph√π h·ª£p v·ªõi quy t·∫Øc n√†y s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn d·ªãch v·ª• t∆∞∆°ng ·ª©ng. B·∫°n c√≥ th·ªÉ tham kh·∫£o m√¥ t·∫£ t·ª´ <a href="https://docs.spring.io/spring-cloud-gateway/reference/spring-cloud-gateway/request-predicates-factories.html" target="_blank" rel="noopener noreferrer">trang ch√≠nh th·ª©c</a>:</p><p>N√≥i ng·∫Øn g·ªçn, Predicate gi√∫p t·∫°o ra m·ªôt t·∫≠p h·ª£p c√°c quy t·∫Øc kh·ªõp ƒë·ªÉ request c√≥ th·ªÉ t√¨m ƒë√∫ng Route (ƒë·ªãnh tuy·∫øn) v√† ƒë∆∞·ª£c x·ª≠ l√Ω.</p><p>Khi t·∫°o ƒë·ªëi t∆∞·ª£ng Route trong Spring Cloud Gateway, <code>RoutePredicateFactory</code> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ƒë·ªëi t∆∞·ª£ng Predicate, v√† ƒë·ªëi t∆∞·ª£ng Predicate n√†y s·∫Ω ƒë∆∞·ª£c g√°n cho Route.</p><ul><li>Spring Cloud Gateway bao g·ªìm nhi·ªÅu Route Predicate Factories ƒë∆∞·ª£c t√≠ch h·ª£p s·∫µn.</li><li>C√°c Predicate n√†y kh·ªõp v·ªõi c√°c thu·ªôc t√≠nh kh√°c nhau c·ªßa request HTTP.</li><li>Nhi·ªÅu Route Predicate Factories c√≥ th·ªÉ ƒë∆∞·ª£c k·∫øt h·ª£p v·ªõi nhau b·∫±ng logic <strong>and</strong>.</li></ul><p>C√°c l·ªõp ch√≠nh c·ªßa Route Predicate Factory ƒë∆∞·ª£c th·ªÉ hi·ªán nh∆∞ trong h√¨nh, bao g·ªìm th·ªùi gian (Datetime), ƒë·ªãa ch·ªâ t·ª´ xa c·ªßa request, tr·ªçng s·ªë c·ªßa ƒë·ªãnh tuy·∫øn, request header, ƒë·ªãa ch·ªâ Host, ph∆∞∆°ng th·ª©c request, ƒë∆∞·ªùng d·∫´n v√† request parameter:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/1716526492684-86556361-5100-4172-946b-e5f825979b3d.png" alt="1716526492684-86556361-5100-4172-946b-e5f825979b3d.png" tabindex="0" loading="lazy"><figcaption>1716526492684-86556361-5100-4172-946b-e5f825979b3d.png</figcaption></figure><p>Ngo√†i ra, ch√∫ng ta c√≥ th·ªÉ t√πy ch·ªânh c√°c quy t·∫Øc ƒë·ªãnh tuy·∫øn theo nhu c·∫ßu. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë Predicate th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng:</p><ul><li><strong>Weight - Kh·ªõp theo tr·ªçng s·ªë</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gateway</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system-a</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9201/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Weight=group1, 8</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system-b</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9201/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Weight=group1, 2</span></span></code></pre></div><ul><li><strong>Datetime - Kh·ªõp request x·∫£y ra sau m·ªôt th·ªùi ƒëi·ªÉm nh·∫•t ƒë·ªãnh</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gateway</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9201/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">After=2021-02-23T14:20:00.000+08:00[Asia/Shanghai]</span></span></code></pre></div><ul><li><strong>Query - Kh·ªõp tham s·ªë truy v·∫•n</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gateway</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9201/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Query=username, abc.</span></span></code></pre></div><ul><li><strong>Path - Kh·ªõp ƒë∆∞·ªùng d·∫´n request</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gateway</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9201/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/system/**</span></span></code></pre></div><ul><li><strong>Header - Kh·ªõp request header, gi√° tr·ªã ph√π h·ª£p v·ªõi bi·ªÉu th·ª©c ch√≠nh quy \d+</strong></li></ul><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gateway</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">http://localhost:9201/</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Header=X-Request-Id, \d+</span></span></code></pre></div><p>N·∫øu c√°c m·∫´u c√≥ s·∫µn kh√¥ng ƒë√°p ·ª©ng ƒë∆∞·ª£c nhu c·∫ßu, b·∫°n c√≥ th·ªÉ <strong>t√πy ch·ªânh quy t·∫Øc ƒëi·ªÅu ki·ªán (Predicate)</strong> theo c√°ch ƒë∆°n gi·∫£n nh∆∞ sau:</p><ul><li>K·∫ø th·ª´a l·ªõp tr·ª´u t∆∞·ª£ng <code>AbstractRoutePredicateFactory</code>.</li><li>Ho·∫∑c tri·ªÉn khai <code>RoutePredicateFactory</code> interface.</li><li>T√™n l·ªõp c√≥ th·ªÉ ƒë·∫∑t t√πy √Ω, nh∆∞ng ph·∫£i k·∫øt th√∫c b·∫±ng h·∫≠u t·ªë <code>RoutePredicateFactory</code>.</li></ul><p>V√≠ d·ª• m√£ ngu·ªìn:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MyRoutePredicateFactory</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AbstractRoutePredicateFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MyRoutePredicateFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> MyRoutePredicateFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        super</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MyRoutePredicateFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Validated</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Setter</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Getter</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NotEmpty</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // C·∫•p ƒë·ªô ng∆∞·ªùi d√πng: Kim c∆∞∆°ng, v√†ng, b·∫°c</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Predicate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServerWebExchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> apply</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MyRoutePredicateFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Predicate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServerWebExchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;()</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServerWebExchange</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> serverWebExchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Ki·ªÉm tra xem tham s·ªë userType c√≥ ƒë√∫ng v·ªõi gi√° tr·ªã ch·ªâ ƒë·ªãnh kh√¥ng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userType</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> serverWebExchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getQueryParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getFirst</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;userType&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (userType </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // So s√°nh gi√° tr·ªã tham s·ªë v·ªõi d·ªØ li·ªáu c·∫•u h√¨nh</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bo-loc-filter" tabindex="-1"><a class="header-anchor" href="#bo-loc-filter"><span>B·ªô l·ªçc (Filter)</span></a></h3><p>B·ªô l·ªçc trong Gateway t∆∞∆°ng t·ª± nh∆∞ b·ªô ch·∫∑n (Interceptor) trong SpringMVC v√† b·ªô l·ªçc trong Servlet. B·ªô l·ªçc c√≥ hai lo·∫°i ch√≠nh l√† &quot;pre&quot; v√† &quot;post&quot;, l·∫ßn l∆∞·ª£t ƒë∆∞·ª£c g·ªçi tr∆∞·ªõc v√† sau khi request ƒë∆∞·ª£c th·ª±c hi·ªán, d√πng ƒë·ªÉ thay ƒë·ªïi th√¥ng tin request v√† ph·∫£n h·ªìi.</p><p>B·ªô l·ªçc c≈©ng l√† m·ªôt trong nh·ªØng c√¢u h·ªèi ph·ªï bi·∫øn trong ph·ªèng v·∫•n, ch·∫≥ng h·∫°n nh∆∞ <strong>ghi l·∫°i th·ªëng k√™ s·ªë l∆∞·ª£ng g·ªçi API, gi·ªõi h·∫°n t·ªëc ƒë·ªô, blacklist v√† tr·∫Øng, v.v.</strong></p><p>Trong c√°c cu·ªôc ph·ªèng v·∫•n, ƒë√¢y l√† m·ªôt trong nh·ªØng ch·ªß ƒë·ªÅ ƒë∆∞·ª£c h·ªèi nhi·ªÅu nh·∫•t, v√¨ v·∫≠y b·∫°n c·∫ßn ch√∫ √Ω üëä.</p><p>B·ªô l·ªçc trong Gateway t∆∞∆°ng t·ª± nh∆∞ b·ªô ch·∫∑n trong SpringMVC v√† b·ªô l·ªçc trong Servlet. &quot;pre&quot; v√† &quot;post&quot; l·∫ßn l∆∞·ª£t ƒë∆∞·ª£c g·ªçi tr∆∞·ªõc v√† sau khi request ƒë∆∞·ª£c th·ª±c hi·ªán, ƒë·ªÉ thay ƒë·ªïi th√¥ng tin request v√† ph·∫£n h·ªìi.</p><p>B·ªô l·ªçc c≈©ng l√† m·ªôt trong nh·ªØng ki·∫øn th·ª©c ph·ªï bi·∫øn nh·∫•t trong ph·ªèng v·∫•n, nh∆∞ ghi l·∫°i s·ªë l·∫ßn g·ªçi API, gi·ªõi h·∫°n t·ªëc ƒë·ªô, blacklist, tr·∫Øng, v.v.</p><p>Theo lo·∫°i, b·ªô l·ªçc ƒë∆∞·ª£c chia th√†nh b·ªô l·ªçc to√†n c·ª•c, b·ªô l·ªçc t√≠ch h·ª£p ƒë∆°n l·∫ª v√† b·ªô l·ªçc t√πy ch·ªânh.</p><h4 id="bo-loc-toan-cuc" tabindex="-1"><a class="header-anchor" href="#bo-loc-toan-cuc"><span>B·ªô l·ªçc to√†n c·ª•c</span></a></h4><p>B·ªô l·ªçc to√†n c·ª•c √°p d·ª•ng cho t·∫•t c·∫£ c√°c Route m√† kh√¥ng c·∫ßn c·∫•u h√¨nh ri√™ng l·∫ª. Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng b·ªô l·ªçc n√†y ƒë·ªÉ th·ª±c hi·ªán nhi·ªÅu request x·ª≠ l√Ω chung nh∆∞ x√°c th·ª±c quy·ªÅn h·∫°n, h·∫°n ch·∫ø truy c·∫≠p IP, v.v. Hi·ªán t·∫°i, Gateway d√πng ƒë·ªÉ x√°c th·ª±c t·∫≠p trung (<code>AuthFilter.java</code>) s·ª≠ d·ª•ng b·ªô l·ªçc to√†n c·ª•c.</p><p>Vi·ªác ƒë·ªãnh nghƒ©a ch·ªâ c·∫ßn tri·ªÉn khai hai interface <code>GlobalFilter</code> v√† <code>Ordered</code>.</p><p>Ph·∫ßn tri·ªÉn khai c·ª• th·ªÉ trong PmHub s·∫Ω ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p ·ªü ph·∫ßn th·ª±c chi·∫øn b√™n d∆∞·ªõi.</p><h4 id="bo-loc-tich-hop-ƒëon-le" tabindex="-1"><a class="header-anchor" href="#bo-loc-tich-hop-ƒëon-le"><span>B·ªô l·ªçc t√≠ch h·ª£p ƒë∆°n l·∫ª</span></a></h4><p><a href="https://docs.spring.io/spring-cloud-gateway/reference/spring-cloud-gateway/gatewayfilter-factories.html" target="_blank" rel="noopener noreferrer">B·ªô l·ªçc t√≠ch h·ª£p ƒë∆°n l·∫ª</a>, c√≤n ƒë∆∞·ª£c g·ªçi l√† b·ªô l·ªçc c·ªßa Gateway, ch·ªß y·∫øu ƒë∆∞·ª£c √°p d·ª•ng cho m·ªôt Route ho·∫∑c m·ªôt s·ªë Route nh·∫•t ƒë·ªãnh.</p><p>M·ªôt s·ªë b·ªô l·ªçc t√≠ch h·ª£p ph·ªï bi·∫øn bao g·ªìm:</p><ul><li><strong>Ch·ªâ ƒë·ªãnh n·ªôi dung request header</strong></li></ul><p>C√≥ th·ªÉ l·ªçc c√°c request d·ª±a tr√™n request header. V√≠ d·ª•, ch·ªâ cho ph√©p c√°c request c√≥ header &quot;X-Request-pmhub&quot; ho·∫∑c &quot;X-Request-pmhub2&quot;.</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GatewayFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;/pay/gateway/filter&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AjaxResult</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getGatewayFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Enumeration</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getHeaderNames</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">hasMoreElements</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> headName</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">nextElement</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> headValue</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getHeader</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(headName);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;T√™n request header: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> headName </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\t\t\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Gi√° tr·ªã request header: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> headValue);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">headName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equalsIgnoreCase</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;X-Request-pmhub&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                    ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> headName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equalsIgnoreCase</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;X-Request-pmhub2&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                result </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> headName </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> headValue </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot; &quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AjaxResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;getGatewayFilter B·ªô l·ªçc test: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> result </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot; </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DateUtil</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>B·∫°n c√≥ th·ªÉ c·∫•u h√¨nh nh∆∞ sau:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/auth/gateway/info/**</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">              # ƒêi·ªÅu ki·ªán, ƒë∆∞·ªùng d·∫´n kh·ªõp v·ªõi Route</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub_routh3</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> #pay_routh3</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">lb://cloud-pmhub-service</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                # Route cung c·∫•p d·ªãch v·ª• sau khi kh·ªõp</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/pay/gateway/filter/**</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">              # ƒêi·ªÅu ki·ªán, kh·ªõp v·ªõi ƒë∆∞·ªùng d·∫´n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AddRequestHeader=X-Request-pmhub,pmhubValue1</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # Th√™m request header kv</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AddRequestHeader=X-Request-pmhub2,pmhubValue2</span></span></code></pre></div><p>V·ªõi c√°ch n√†y, b·∫°n c√≥ th·ªÉ l·ªçc c√°c request d·ª±a tr√™n n·ªôi dung header ƒë·ªÉ x·ª≠ l√Ω x√°c th·ª±c ho·∫∑c c√°c tr∆∞·ªùng h·ª£p kh√°c.</p><ul><li><strong>Ch·ªâ ƒë·ªãnh request parameter</strong></li></ul><p>B·∫°n c√≥ th·ªÉ l·ªçc c√°c request d·ª±a tr√™n request parameter. Ch·ªâ c√°c request c√≥ tham s·ªë m·ªõi ƒë∆∞·ª£c th·ª±c hi·ªán.</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/auth/gateway/filter/**</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">              # ƒêi·ªÅu ki·ªán, kh·ªõp v·ªõi ƒë∆∞·ªùng d·∫´n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AddRequestParameter=customerId,9527001</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Th√™m request parameter: k, v</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">RemoveRequestParameter=customerName</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   # X√≥a tham s·ªë URL customerName</span></span></code></pre></div><ul><li><strong>Ch·ªâ ƒë·ªãnh response header</strong></li></ul><p>C√≥ th·ªÉ th√™m response header ƒë·ªÉ h·ªá th·ªëng ho·∫∑c ·ª©ng d·ª•ng web x·ª≠ l√Ω t∆∞∆°ng ·ª©ng.</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/auth/gateway/filter/**</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">              # ƒêi·ªÅu ki·ªán, kh·ªõp v·ªõi ƒë∆∞·ªùng d·∫´n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AddResponseHeader=X-Response-pmhub, BlueResponse</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Th√™m header X-Response-pmhub v√† gi√° tr·ªã BlueResponse</span></span></code></pre></div><ul><li><strong>Ch·ªâ ƒë·ªãnh ti·ªÅn t·ªë v√† ƒë∆∞·ªùng d·∫´n</strong></li></ul><p>B·∫°n c√≥ th·ªÉ l·ªçc v√† ƒë·ªãnh tuy·∫øn l·∫°i ƒë∆∞·ªùng d·∫´n, c·∫•u h√¨nh nh∆∞ sau:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/auth/gateway/filter/**</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">              # ƒêi·ªÅu ki·ªán, kh·ªõp v·ªõi ƒë∆∞·ªùng d·∫´n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">PrefixPath=/pmhub</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # http://localhost:6880/pmhub/gateway/filter</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">RedirectTo=302, https://abcdxyzt.com/</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Chuy·ªÉn h∆∞·ªõng ƒë·∫øn abcdxyzt.com</span></span></code></pre></div><h4 id="bo-loc-tuy-chinh" tabindex="-1"><a class="header-anchor" href="#bo-loc-tuy-chinh"><span>B·ªô l·ªçc t√πy ch·ªânh</span></a></h4><p>C√¢u h·ªèi ph·ªèng v·∫•n kinh ƒëi·ªÉn: L√†m th·∫ø n√†o ƒë·ªÉ th·ªëng k√™ th·ªùi gian x·ª≠ l√Ω khi g·ªçi API? H√£y tr√¨nh b√†y √Ω t∆∞·ªüng thi·∫øt k·∫ø c·ªßa b·∫°n?</p><p>Ch√∫ng ta c√≥ th·ªÉ t·∫≠n d·ª•ng t√≠nh nƒÉng b·ªô l·ªçc t√πy ch·ªânh c·ªßa Gateway ƒë·ªÉ th·ª±c hi·ªán ch·ª©c nƒÉng n√†y. ƒê·ªÉ t·∫°o b·ªô l·ªçc to√†n c·ª•c t√πy ch·ªânh, ch·ªâ c·∫ßn tri·ªÉn khai hai interface <code>GlobalFilter</code> v√† <code>Ordered</code>, v√† trong ph∆∞∆°ng th·ª©c <code>filter</code>, ch√∫ng ta s·∫Ω th·ªëng k√™ th·ªùi gian truy c·∫≠p API. V√≠ d·ª• nh∆∞ ƒëo·∫°n m√£ d∆∞·ªõi ƒë√¢y:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> chain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(exchange).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fromRunnable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Long</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> beginVisitTime</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getAttribute</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(BEGIN_VISIT_TIME);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (beginVisitTime </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API Server: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getHost</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API Gateway: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPort</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API URL: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API URL Parameter: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRawQuery</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API execution time: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> beginVisitTime) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;ms&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;###################################################&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}));</span></span></code></pre></div><h2 id="cau-hinh-gioi-han-luu-luong-rate-limiter" tabindex="-1"><a class="header-anchor" href="#cau-hinh-gioi-han-luu-luong-rate-limiter"><span>C·∫•u h√¨nh gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng (Rate limiter)</span></a></h2><p>Gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng (rate limiter), nh∆∞ t√™n g·ªçi, l√† h·∫°n ch·∫ø lu·ªìng truy c·∫≠p. B·∫±ng c√°ch th·ª±c hi·ªán c√°c bi·ªán ph√°p gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng, ch√∫ng ta c√≥ th·ªÉ qu·∫£n l√Ω hi·ªáu qu·∫£ s·ªë l∆∞·ª£ng y√™u c·∫ßu m·ªói gi√¢y (QPS), t·ª´ ƒë√≥ b·∫£o v·ªá h·ªá th·ªëng.</p><p>C√°c thu·∫≠t to√°n gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng ph·ªï bi·∫øn bao g·ªìm: <strong>thu·∫≠t to√°n b·ªô ƒë·∫øm</strong>, <strong>thu·∫≠t to√°n Leaky Bucket</strong>, v√† <strong>thu·∫≠t to√°n Token Bucket</strong>.</p><p>Trong Spring Cloud Gateway, l·ªõp <code>RequestRateLimiterGatewayFilterFactory</code> cung c·∫•p t√≠nh nƒÉng gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng d·ª±a tr√™n thu·∫≠t to√°n token bucket, k·∫øt h·ª£p v·ªõi Redis v√† Lua scripts.</p><ol><li>Th√™m c√°c ph·ª• thu·ªôc</li></ol><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- Ph·ª• thu·ªôc reactive cho spring data redis --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-data-redis-reactive&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><ol start="2"><li>Quy t·∫Øc gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng, d·ª±a tr√™n URI</li></ol><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  redis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    host</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">localhost</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    port</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6379</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # system module</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">lb://pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/system/**</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">StripPrefix=1</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">RequestRateLimiter</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">              args</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                redis-rate-limiter.replenishRate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # T·ªëc ƒë·ªô n·∫°p token m·ªói gi√¢y</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                redis-rate-limiter.burstCapacity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # T·ªïng dung l∆∞·ª£ng token bucket</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                key-resolver</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;#{@pathKeyResolver}&quot;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # S·ª≠ d·ª•ng SpEL ƒë·ªÉ tham chi·∫øu bean theo t√™n</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>C·∫•u h√¨nh <code>StripPrefix=1</code> c√≥ nghƒ©a l√† khi Gateway chuy·ªÉn ti·∫øp ƒë·∫øn module d·ªãch v·ª•, n√≥ s·∫Ω t·ª± ƒë·ªông b·ªè ti·ªÅn t·ªë. C·∫•u h√¨nh n√†y c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh t√πy theo tr∆∞·ªùng h·ª£p c·ª• th·ªÉ.</p></div><ol start="3"><li>Vi·∫øt l·ªõp c·∫•u h√¨nh quy t·∫Øc gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng theo URI</li></ol><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * L·ªõp c·∫•u h√¨nh quy t·∫Øc gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> KeyResolverConfiguration</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> KeyResolver</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> pathKeyResolver</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> exchange </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">just</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ol start="4"><li>Ki·ªÉm tra d·ªãch v·ª• ƒë·ªÉ x√°c minh gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng</li></ol><p>Kh·ªüi ƒë·ªông d·ªãch v·ª• Gateway <code>PmHubGatewayApplication.java</code> v√† d·ªãch v·ª• h·ªá th·ªëng <code>PmHubSystemApplication.java</code>.</p><p>V√¨ d·ªãch v·ª• Gateway c√≥ x√°c th·ª±c quy·ªÅn truy c·∫≠p, b·∫°n c√≥ th·ªÉ thi·∫øt l·∫≠p whitelist <code>/system/**</code> trong c·∫•u h√¨nh Gateway ƒë·ªÉ ki·ªÉm tra. Khi g·ª≠i nhi·ªÅu y√™u c·∫ßu, b·∫°n s·∫Ω th·∫•y tr·∫£ v·ªÅ HTTP ERROR 429, ƒë·ªìng th·ªùi Redis s·∫Ω ch·ª©a hai kh√≥a, bi·ªÉu th·ªã r·∫±ng gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng ƒë√£ th√†nh c√¥ng.</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">request_rate_limiter.{xxx}.timestamp</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">xxx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">.tokens</span></span></code></pre></div><p>B·∫°n c≈©ng c√≥ th·ªÉ c·∫•u h√¨nh quy t·∫Øc gi·ªõi h·∫°n l∆∞u l∆∞·ª£ng kh√°c, nh∆∞ gi·ªõi h·∫°n theo tham s·ªë ho·∫∑c theo IP, nh∆∞ sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Gi·ªõi h·∫°n theo tham s·ªë</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> KeyResolver</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> parameterKeyResolver</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> exchange </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">just</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getQueryParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getFirst</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;userId&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Gi·ªõi h·∫°n theo IP</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> KeyResolver</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ipKeyResolver</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> exchange </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">just</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRemoteAddress</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getHostName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><h2 id="cau-hinh-blacklist" tabindex="-1"><a class="header-anchor" href="#cau-hinh-blacklist"><span>C·∫•u h√¨nh blacklist</span></a></h2><p>Nh∆∞ t√™n g·ªçi, blacklist l√† nh·ªØng URL b·ªã c·∫•m truy c·∫≠p. ƒê·ªÉ th·ª±c hi·ªán ch·ª©c nƒÉng n√†y, c√≥ th·ªÉ t·∫°o b·ªô l·ªçc t√πy ch·ªânh <code>BlackListUrlFilter</code> v√† c·∫•u h√¨nh danh s√°ch URL ƒëen <code>blacklistUrl</code>. Dƒ© nhi√™n, n·∫øu c√≥ nhu c·∫ßu kh√°c, b·∫°n c≈©ng c√≥ th·ªÉ tri·ªÉn khai c√°c b·ªô l·ªçc v·ªõi quy t·∫Øc t√πy ch·ªânh ƒë·ªÉ ƒë√°p ·ª©ng y√™u c·∫ßu c·ª• th·ªÉ.</p><p>C·∫•u h√¨nh b·ªô l·ªçc blacklist trong pmhub:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * B·ªô l·ªçc blacklist</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> BlackListUrlFilter</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AbstractGatewayFilterFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">BlackListUrlFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GatewayFilter</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> apply</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (exchange, chain) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> url</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">matchBlacklist</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(url)) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">webFluxResponseWriter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;ƒê·ªãa ch·ªâ y√™u c·∫ßu kh√¥ng ƒë∆∞·ª£c ph√©p truy c·∫≠p&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> chain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(exchange);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> BlackListUrlFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        super</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> blacklistUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Pattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> blacklistUrlPattern </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> matchBlacklist</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">blacklistUrlPattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&amp;&amp;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> blacklistUrlPattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">anyMatch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(p </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(url).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getBlacklistUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> blacklistUrl;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setBlacklistUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">blacklistUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">blacklistUrl</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> blacklistUrl;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">blacklistUrlPattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">clear</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">blacklistUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(url </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">blacklistUrlPattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Pattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">compile</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">replaceAll</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">*</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;(.*?)&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Pattern</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CASE_INSENSITIVE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>V·ªÅ sau, n·∫øu kh√¥ng mu·ªën cho ph√©p truy c·∫≠p URL n√†o, ch·ªâ c·∫ßn <strong>th√™m v√†o blacklist</strong> l√† xong.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    gateway</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      routes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # system module</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          uri</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">lb://pmhub-system</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          predicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">Path=/system/**</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          filters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">StripPrefix=0</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            - </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">BlackListUrlFilter</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">              args</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                blacklistUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/user/list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cau-hinh-whitelist" tabindex="-1"><a class="header-anchor" href="#cau-hinh-whitelist"><span>C·∫•u h√¨nh whitelist</span></a></h2><p>Nh∆∞ t√™n g·ªçi, whitelist bao g·ªìm c√°c ƒë·ªãa ch·ªâ ƒë∆∞·ª£c ph√©p truy c·∫≠p m√† kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p. V√≠ d·ª• nh∆∞ c√°c API ƒëƒÉng nh·∫≠p, ƒëƒÉng k√Ω, v√† nh·ªØng API kh√¥ng y√™u c·∫ßu gateway x√°c th·ª±c ƒë·ªÅu c√≥ th·ªÉ n·∫±m trong whitelist. N·∫øu y√™u th√≠ch ƒë·ªãa ch·ªâ n√†o, b·∫°n c√≥ th·ªÉ th√™m n√≥ v√†o ƒë√¢y! ÔººÔºàÔºæ ÔºæÔºâÔºè. Trong c·∫•u h√¨nh <code>ignore</code> ƒë·∫∑t <code>whites</code>, nghƒ©a l√† cho ph√©p truy c·∫≠p ·∫©n danh.</p><p>Ch·ªâ c·∫ßn th√™m ƒëo·∫°n logic sau v√†o b·ªô l·ªçc to√†n c·ª•c:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// B·ªè qua c√°c ƒë∆∞·ªùng d·∫´n kh√¥ng c·∫ßn x√°c th·ª±c</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">matches</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(url, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ignoreWhite</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getWhites</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> chain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(exchange);</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>C·∫•u h√¨nh trong file YAML:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Kh√¥ng x√°c th·ª±c c√°c URL trong whitelist</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ignore</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  whites</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/auth/logout</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/auth/login</span></span></code></pre></div><p>Tr√™n ƒë√¢y l√† gi·ªõi thi·ªáu v·ªÅ b·ªô l·ªçc trong gateway v√† c√°c ch·ª©c nƒÉng th∆∞·ªùng d√πng. <strong>√Åp d·ª•ng v√†o d·ª± √°n th·ª±c t·∫ø</strong>, hi·ªÉu v√† s·ª≠ d·ª•ng c√°c kh√°i ni·ªám v√† ph∆∞∆°ng ph√°p n√†y kh√¥ng h·ªÅ kh√≥, th·∫≠m ch√≠ c√≤n c√≥ th·ªÉ ghi v√†o CV ƒë·ªÉ g√¢y ·∫•n t∆∞·ª£ng v·ªõi nh√† tuy·ªÉn d·ª•ng.</p><h1 id="thuc-chien-du-an" tabindex="-1"><a class="header-anchor" href="#thuc-chien-du-an"><span>Th·ª±c chi·∫øn d·ª± √°n</span></a></h1><p>Ti·∫øp theo, m√¨nh s·∫Ω gi·∫£i th√≠ch c·ª• th·ªÉ c√°ch th·ª±c hi·ªán b·ªô l·ªçc to√†n c·ª•c trong PmHub v√† c√°ch th·ªëng k√™ th·ªùi gian g·ªçi API.</p><h2 id="cach-viet-bo-loc-toan-cuc" tabindex="-1"><a class="header-anchor" href="#cach-viet-bo-loc-toan-cuc"><span>C√°ch vi·∫øt b·ªô l·ªçc to√†n c·ª•c</span></a></h2><ul><li><strong>B∆∞·ªõc 1</strong>: T·∫°o l·ªõp <code>AuthFilter</code></li></ul><p>Trong d·ªãch v·ª• gateway <code>pmhub-gateway</code>, t·∫°o l·ªõp <code>AuthFilter</code> trong th∆∞ m·ª•c <code>filter</code> v√† tri·ªÉn khai c√°c interface <code>GlobalFilter</code> v√† <code>Ordered</code>.</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Component</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AuthFilter</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GlobalFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Ordered</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><code>GlobalFilter</code> l√† interface b·ªô l·ªçc to√†n c·ª•c t√≠ch h·ª£p trong gateway, ch·ªâ c√≥ m·ªôt ph∆∞∆°ng th·ª©c, do ƒë√≥, ta ch·ªâ c·∫ßn tri·ªÉn khai ph∆∞∆°ng th·ª©c ƒë√≥.</p><p><code>Ordered</code> l√† interface trong Spring Framework d√πng ƒë·ªÉ x√°c ƒë·ªãnh th·ª© t·ª± ∆∞u ti√™n.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Trong interface n√†y c√≥ hai h·∫±ng s·ªë l√† <code>HIGHEST_PRECEDENCE</code> v√† <code>LOWEST_PRECEDENCE</code>, l·∫ßn l∆∞·ª£t bi·ªÉu th·ªã th·ª© t·ª± ∆∞u ti√™n cao nh·∫•t v√† th·∫•p nh·∫•t. Ch·ª©c nƒÉng ch√≠nh c·ªßa interface n√†y l√† th√¥ng qua ph∆∞∆°ng th·ª©c <code>getOrder()</code> tr·∫£ v·ªÅ m·ªôt s·ªë nguy√™n, s·ªë n√†y bi·ªÉu th·ªã m·ª©c ƒë·ªô ∆∞u ti√™n c·ªßa ƒë·ªëi t∆∞·ª£ng. Trong Spring Framework, n·∫øu m·ªôt ƒë·ªëi t∆∞·ª£ng tri·ªÉn khai interface <code>Ordered</code>, n√≥ s·∫Ω ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh m·ª©c ƒë·ªô ∆∞u ti√™n, v√† Spring container s·∫Ω quy·∫øt ƒë·ªãnh th·ª© t·ª± t·∫°o v√† g·ªçi c√°c ƒë·ªëi t∆∞·ª£ng d·ª±a tr√™n m·ª©c ƒë·ªô ∆∞u ti√™n n√†y.</p></div><ul><li><strong>B∆∞·ªõc 2</strong>: Tri·ªÉn khai ph∆∞∆°ng th·ª©c <code>filter</code></li></ul><p>Trong b·ªô l·ªçc, th·ª±c hi·ªán c√°c b∆∞·ªõc ch√≠nh sau:</p><ol><li>L·ªçc whitelist</li><li>X√°c th·ª±c <code>token</code></li><li>Thi·∫øt l·∫≠p th√¥ng tin ng∆∞·ªùi d√πng cho request</li><li>Ghi l·∫°i th·ªùi gian g·ªçi API</li></ol><p>M√£ ngu·ªìn:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Mono</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Void</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> filter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServerWebExchange</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GatewayFilterChain</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> chain) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ServerHttpRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> request </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ServerHttpRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Builder</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mutate </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> url </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // B·ªè qua c√°c ƒë∆∞·ªùng d·∫´n kh√¥ng c·∫ßn x√°c th·ª±c</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">matches</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(url, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ignoreWhite</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getWhites</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> chain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(exchange);</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> token </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getToken</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(request)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(token)</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> unauthorizedResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Token kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Claims</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> claims </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> JwtUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">parseToken</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(token);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (claims </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> unauthorizedResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Token ƒë√£ h·∫øt h·∫°n ho·∫∑c kh√¥ng h·ª£p l·ªá!&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userkey </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> JwtUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserKey</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(claims);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> islogin </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> redisService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">hasKey</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTokenKey</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(userkey));</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">islogin) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> unauthorizedResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userid </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> JwtUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(claims);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> username </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> JwtUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(claims);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(userid)</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isEmpty</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(username)</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> unauthorizedResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;X√°c th·ª±c token th·∫•t b·∫°i&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thi·∫øt l·∫≠p th√¥ng tin ng∆∞·ªùi d√πng v√†o request</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    addHeader</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityConstants</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">USER_KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userkey)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    addHeader</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityConstants</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DETAILS_USER_ID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userid)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    addHeader</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityConstants</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DETAILS_USERNAME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> username)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // X√≥a th√¥ng tin n·ªôi b·ªô ƒë·ªÉ tr√°nh r·ªßi ro b·∫£o m·∫≠t</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    removeHeader</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityConstants</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FROM_SOURCE</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Ghi l·∫°i th·ªùi gian b·∫Øt ƒë·∫ßu g·ªçi API</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getAttributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(BEGIN_VISIT_TIME, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> chain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>B∆∞·ªõc 3</strong>: C·∫•u h√¨nh <code>bootstrap.yml</code></li></ul><p>C·∫•u h√¨nh nh∆∞ sau:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Spring</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # T√™n ·ª©ng d·ª•ng</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">pmhub-gateway</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  profiles</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # C·∫•u h√¨nh m√¥i tr∆∞·ªùng</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    active</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">dev</span></span></code></pre></div><p>Nh∆∞ v·∫≠y, b·ªô l·ªçc t√πy ch·ªânh trong gateway PmHub ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai th√†nh c√¥ng.</p><h2 id="cach-thong-ke-thoi-gian-goi-api" tabindex="-1"><a class="header-anchor" href="#cach-thong-ke-thoi-gian-goi-api"><span>C√°ch th·ªëng k√™ th·ªùi gian g·ªçi API</span></a></h2><p>Trong PmHub, ƒë·ªÉ th·ªëng k√™ th·ªùi gian g·ªçi API, ta th·ª±c hi·ªán theo h∆∞·ªõng d·∫´n sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ƒê·∫ßu ti√™n, ghi l·∫°i th·ªùi gian b·∫Øt ƒë·∫ßu truy c·∫≠p API</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getAttributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(BEGIN_VISIT_TIME, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span></code></pre></div><p>ƒêo·∫°n m√£ n√†y c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong <strong>CV</strong> ƒë·ªÉ tƒÉng ƒëi·ªÉm c·ªông ƒë√°ng k·ªÉ.</p><p>Ngo√†i ra, b·∫°n c√≥ th·ªÉ k·∫øt h·ª£p th·ªëng k√™ n√†y v·ªõi c√°c time slice database, l∆∞u tr·ªØ th√¥ng tin g·ªçi API trong ƒë√≥, v√† t√πy ch·ªânh hi·ªÉn th·ªã th√¥ng tin th·ªùi gian.</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> chain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(exchange).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fromRunnable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Long</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> beginVisitTime</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getAttribute</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(BEGIN_VISIT_TIME);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (beginVisitTime </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API Server: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getHost</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API Gateway: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPort</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API URL: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API URL Parameter: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> exchange</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRawQuery</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;API execution time: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> beginVisitTime) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;ms&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;###################################################&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}));</span></span></code></pre></div><h1 id="du-ƒëoan-cau-hoi-phong-van" tabindex="-1"><a class="header-anchor" href="#du-ƒëoan-cau-hoi-phong-van"><span>D·ª± ƒëo√°n c√¢u h·ªèi ph·ªèng v·∫•n</span></a></h1><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>T√¥i ƒë√£ ƒëi ph·ªèng v·∫•n nhi·ªÅu, khi th·∫•y nh·ªØng k·ªπ thu·∫≠t n√†y trong d·ª± √°n c·ªßa t√¥i, nh·ªØng c√¢u h·ªèi sau ƒë√¢y th∆∞·ªùng ƒë∆∞·ª£c h·ªèi trong c√°c bu·ªïi ph·ªèng v·∫•n.</p></div><p><strong>1. Gateway l√† g√¨, v√† vai tr√≤ c·ªßa n√≥ trong ki·∫øn tr√∫c microservices l√† g√¨?</strong></p><blockquote><p>Gateway trong ki·∫øn tr√∫c microservices l√† m·ªôt th√†nh ph·∫ßn ·ªü ph√≠a tr∆∞·ªõc c√°c d·ªãch v·ª• microservices, ho·∫°t ƒë·ªông nh∆∞ c·ª≠a ng√µ cho t·∫•t c·∫£ c√°c d·ªãch v·ª•. N√≥ ch·ªãu tr√°ch nhi·ªám ƒë·ªãnh tuy·∫øn y√™u c·∫ßu, c√¢n b·∫±ng t·∫£i, x√°c th·ª±c b·∫£o m·∫≠t, ki·ªÉm so√°t l∆∞u l∆∞·ª£ng, gi√°m s√°t v√† ghi nh·∫≠t k√Ω. Gateway gi√∫p k·∫øt h·ª£p nhi·ªÅu d·ªãch v·ª• th√†nh m·ªôt API duy nh·∫•t, gi√∫p ƒë∆°n gi·∫£n h√≥a vi·ªác giao ti·∫øp gi·ªØa client v√† microservices.</p></blockquote><p><strong>2. ƒê√£ c√≥ Nginx, t·∫°i sao c·∫ßn s·ª≠ d·ª•ng SpringCloud Gateway, v√† s·ª± kh√°c bi·ªát gi·ªØa hai c√°i l√† g√¨?</strong></p><blockquote><p>Nginx ch·ªß y·∫øu ch·ªãu tr√°ch nhi·ªám c√¢n b·∫±ng t·∫£i ·ªü t·∫ßng transport (Layer 4) trong ki·∫øn tr√∫c microservices, l√† gateway ti·ªÅn x·ª≠ l√Ω. SpringCloud Gateway g·∫ßn v·ªõi ph√≠a d·ªãch v·ª• h∆°n, th∆∞·ªùng ƒë√≥ng vai tr√≤ l√†m API Gateway v√† c√≥ th·ªÉ d·ªÖ d√†ng t√πy ch·ªânh logic ƒë·ªÉ ph√π h·ª£p v·ªõi y√™u c·∫ßu nghi·ªáp v·ª•, ƒë∆∞·ª£c s·ª≠ d·ª•ng ch·ªß y·∫øu cho c√¢n b·∫±ng t·∫£i t·∫ßng application (Layer 7).</p><p>Tuy nhi√™n, SpringCloud Gateway ƒë∆∞·ª£c vi·∫øt b·∫±ng Java, hi·ªáu su·∫•t kh√¥ng th·ªÉ s√°nh v·ªõi Nginx, ƒë∆∞·ª£c vi·∫øt b·∫±ng C++ v·ªõi kh·∫£ nƒÉng x·ª≠ l√Ω cao h∆°n. Do ƒë√≥, Nginx th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü ph√≠a tr∆∞·ªõc ƒë·ªÉ x·ª≠ l√Ω l∆∞u l∆∞·ª£ng l·ªõn tr∆∞·ªõc khi chuy·ªÉn ƒë·∫øn SpringCloud Gateway.</p><p>Ngo√†i ch·ª©c nƒÉng gateway, Nginx c≈©ng th∆∞·ªùng ƒë∆∞·ª£c d√πng l√†m m√°y ch·ªß ph·ª•c v·ª• t√†i nguy√™n tƒ©nh. Vi·ªác k·∫øt h·ª£p c·∫£ hai th·ªÉ hi·ªán s·ª± ph√¢n t√°ch nhi·ªám v·ª• r√µ r√†ng v√† ph·∫£n √°nh s·ª± ph√°t tri·ªÉn c·ªßa ki·∫øn tr√∫c h·ªá th·ªëng.</p></blockquote><p><strong>3. B·∫°n ƒë√£ vi·∫øt Global Filter c·ªßa SpringCloud Gateway nh∆∞ th·∫ø n√†o?</strong></p><blockquote><p>Trong d·ª± √°n PmHub, t√¥i ƒë√£ t·∫°o m·ªôt b·ªô l·ªçc AuthFilter ri√™ng trong d·ªãch v·ª• Gateway, tri·ªÉn khai interface GlobalFilter c·ªßa gateway v√† t·ª± ƒë·ªãnh nghƒ©a ph∆∞∆°ng th·ª©c <code>filter</code>. Trong ph∆∞∆°ng th·ª©c n√†y, t√¥i ƒë√£ l√†m c√°c nhi·ªám v·ª• nh∆∞: l·ªçc danh s√°ch tr·∫Øng, x√°c th·ª±c token v√† th√™m th√¥ng tin ng∆∞·ªùi d√πng v√†o request header ƒë·ªÉ s·ª≠ d·ª•ng trong c√°c d·ªãch v·ª• kh√°c. Ngo√†i ra, t√¥i c√≤n ghi l·∫°i th·ªùi gian b·∫Øt ƒë·∫ßu truy c·∫≠p ƒë·ªÉ th·ªëng k√™ th·ªùi gian g·ªçi API.</p><p>AuthFilter c≈©ng tri·ªÉn khai interface Ordered c·ªßa Spring v√† tr·∫£ v·ªÅ gi√° tr·ªã -200 ƒë·ªÉ ∆∞u ti√™n l·ªçc n√†y ƒë∆∞·ª£c t·∫£i tr∆∞·ªõc ti√™n trong Spring.</p></blockquote><p><strong>4. B·∫°n ƒë√£ th·ªëng k√™ th·ªùi gian g·ªçi API nh∆∞ th·∫ø n√†o? Chi ti·∫øt th·ª±c hi·ªán ra sao?</strong></p><blockquote><p>T√¥i ƒë√£ th√™m m√£ ƒë·ªÉ th·ªëng k√™ th·ªùi gian truy c·∫≠p API trong b·ªô l·ªçc t·ª± ƒë·ªãnh nghƒ©a c·ªßa gateway. Sau ƒë√≥, t√¥i k·∫øt h·ª£p v·ªõi time slice database ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin ho·∫∑c s·ª≠ d·ª•ng Spring Boot Actuator v√† Spring Boot Admin ƒë·ªÉ gi√°m s√°t d·ªãch v·ª• chi ti·∫øt.</p></blockquote><p><strong>5. Trong qu√° tr√¨nh t·ª± ƒë·ªãnh nghƒ©a gateway v√† x√°c th·ª±c, b·∫°n ƒë√£ g·∫∑p nh·ªØng th√°ch th·ª©c n√†o v√† l√†m sao b·∫°n gi·∫£i quy·∫øt?</strong></p><blockquote><ol><li><strong>Th√°ch th·ª©c v·ªÅ hi·ªáu su·∫•t:</strong><br> Trong m√¥i tr∆∞·ªùng t·∫£i cao, logic x√°c th·ª±c c·ªßa gateway c√≥ th·ªÉ tr·ªü th√†nh n√∫t th·∫Øt c·ªï chai, g√¢y ra ƒë·ªô tr·ªÖ.</li></ol><p><strong>Gi·∫£i ph√°p:</strong> S·ª≠ d·ª•ng c∆° ch·∫ø cache ƒë·ªÉ gi·∫£m s·ªë l·∫ßn g·ªçi ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu ho·∫∑c server x√°c th·ª±c, l∆∞u th√¥ng tin x√°c th·ª±c c·ªßa ng∆∞·ªùi d√πng trong cache trong m·ªôt kho·∫£ng th·ªùi gian nh·∫•t ƒë·ªãnh.</p></blockquote><blockquote><ol start="2"><li><strong>T√≠nh m·ªü r·ªông:</strong><br> Khi h·ªá th·ªëng m·ªü r·ªông, c√≥ th·ªÉ s·∫Ω th√™m c√°c d·ªãch v·ª• v√† ph∆∞∆°ng th·ª©c x√°c th·ª±c m·ªõi, ƒëi·ªÅu n√†y t·∫°o ra th√°ch th·ª©c cho t√≠nh m·ªü r·ªông c·ªßa h·ªá th·ªëng x√°c th·ª±c.</li></ol><p><strong>Gi·∫£i ph√°p:</strong> T√°ch logic x√°c th·ª±c th√†nh m·ªôt d·ªãch v·ª• ri√™ng ƒë·ªÉ d·ªÖ d√†ng m·ªü r·ªông v√† b·∫£o tr√¨.</p></blockquote><blockquote><ol start="3"><li><strong>Ghi nh·∫≠t k√Ω v√† gi√°m s√°t:</strong><br> C·∫ßn ghi l·∫°i chi ti·∫øt h√†nh vi x√°c th·ª±c c·ªßa ng∆∞·ªùi d√πng v√† gi√°m s√°t qu√° tr√¨nh x√°c th·ª±c ƒë·ªÉ c√≥ th·ªÉ ki·ªÉm tra khi c√≥ v·∫•n ƒë·ªÅ x·∫£y ra.</li></ol><p><strong>Gi·∫£i ph√°p:</strong> Th√™m ghi nh·∫≠t k√Ω chi ti·∫øt cho c√°c b∆∞·ªõc quan tr·ªçng trong qu√° tr√¨nh x√°c th·ª±c v√† tri·ªÉn khai h·ªá th·ªëng gi√°m s√°t ƒë·ªÉ theo d√µi hi·ªáu su·∫•t v√† t·ª∑ l·ªá l·ªói c·ªßa d·ªãch v·ª• x√°c th·ª±c theo th·ªùi gian th·ª±c.</p></blockquote></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/project/pmhub/gateway.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ‚ù§Ô∏è by Hung Nguyen</div><div class="copyright">Copyright ¬© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CmlOSuIY.js" defer></script>
  </body>
</html>
